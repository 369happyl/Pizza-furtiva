<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pizza Adventure: Ultra Edition</title>
    <style>
        :root {
            --sky-blue: #4dbcf9;
            --grass-green: #2ecc71;
            --lava-red: #e74c3c;
            --cave-dark: #2c3e50;
        }

        body { 
            margin: 0; padding: 0; overflow: hidden; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            user-select: none; background: #111; touch-action: none; 
        }

        #viewport { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        
        /* Backgrounds Din√¢micos */
        #world { position: absolute; height: 100vh; transition: background 1s ease; }
        .surface-bg { background: linear-gradient(to bottom, #4dbcf9 0%, #fff 100%); }
        .cave-bg { background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); }
        .sky-bg { background: linear-gradient(to bottom, #1e3c72, #2a5298); }
        .lava-bg { background: linear-gradient(to bottom, #200101, #4a0000); }

        /* Ch√£o Estilizado */
        #ground { 
            position: absolute; bottom: 0; width: 100%; height: 60px; 
            background: #27ae60; border-top: 8px solid #2ecc71; z-index: 10;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
        }
        .cave-ground { background: #1a1a1a !important; border-top: 8px solid #444 !important; }
        .lava-ground { 
            background: #ff4500 !important; 
            border-top: 8px solid #ffae00 !important; 
            box-shadow: 0 -15px 30px #ff4500; 
        }

        /* HUD - Interface */
        #hud { 
            position: fixed; top: 25px; left: 25px; z-index: 1000; 
            color: white; font-weight: 900; letter-spacing: 1px;
            background: rgba(0,0,0,0.4); padding: 15px; border-radius: 15px;
            backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1);
        }
        .life-container { margin-top: 8px; font-size: 24px; filter: drop-shadow(0 0 5px red); }

        /* Controles Mobile */
        .controls { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; z-index: 1000; }
        .btn { 
            width: 85px; height: 85px; background: rgba(255, 255, 255, 0.2); 
            border: 4px solid rgba(255,255,255,0.6); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 35px; color: white; backdrop-filter: blur(10px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3); transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.9); background: rgba(255,255,255,0.4); }

        /* Player - A Pizza */
        #player { 
            width: 50px; height: 50px; background: #f1c40f; border-radius: 50%; 
            position: absolute; border: 4px solid #e67e22; z-index: 100;
            box-shadow: inset -5px -5px 0 rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.2);
        }
        .mio { width: 10px; height: 10px; background: #c0392b; border-radius: 50%; position: absolute; }

        /* Elementos do Mundo */
        .mountain { 
            position: absolute; bottom: 60px; width: 800px; height: 600px; 
            background: #95a5a6; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); 
            z-index: 2; opacity: 0.4; filter: blur(1px);
        }
        .tree { position: absolute; bottom: 60px; width: 25px; height: 50px; background: #795548; z-index: 5; }
        .tree::after { 
            content: ''; position: absolute; bottom: 30px; left: -25px; 
            width: 75px; height: 75px; background: #27ae60; border-radius: 50%;
            box-shadow: inset -10px -10px 0 rgba(0,0,0,0.1);
        }
        .pipe { 
            position: absolute; bottom: 60px; width: 85px; height: 120px; 
            background: #27ae60; border: 5px solid #1b5e20; z-index: 20; 
            border-radius: 10px 10px 0 0; box-shadow: 10px 0 20px rgba(0,0,0,0.2);
        }
        .platform { 
            position: absolute; background: #8d6e63; border-bottom: 6px solid #5d4037; 
            border-radius: 8px; z-index: 15; box-shadow: 0 10px 20px rgba(0,0,0,0.3); 
        }
        .coin { 
            width: 25px; height: 25px; background: #f1c40f; border-radius: 50%; 
            position: absolute; border: 3px solid #f39c12; z-index: 40; 
            box-shadow: 0 0 15px #f1c40f; animation: spin 0.8s infinite linear; 
        }
        @keyframes spin { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

        .enemy { 
            width: 45px; height: 40px; background: #e74c3c; border-radius: 12px; 
            position: absolute; z-index: 50; border: 4px solid #c0392b;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
        }
        .spike { 
            position: absolute; bottom: 60px; width: 45px; height: 45px; 
            background: #bdc3c7; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); z-index: 15;
            background: linear-gradient(to top, #7f8c8d, #bdc3c7);
        }

        #game-over { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: none; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 2000; color: white; 
        }
        #game-over h1 { font-size: 60px; text-shadow: 0 0 20px #ff0000; margin-bottom: 10px; }

        .particle { position: absolute; width: 6px; height: 6px; border-radius: 50%; pointer-events: none; z-index: 90; animation: fadeOut 0.6s forwards; }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(30px) scale(0); } }
    </style>
</head>
<body class="surface-bg">

    <div id="hud">
        <div>POINTS: <span id="score-val" style="color: #f1c40f;">0</span> | <span id="loc">Superf√≠cie</span></div>
        <div class="life-container" id="lives-display">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="controls">
        <div id="btnLeft" class="btn">‚óÄ</div>
        <div id="btnUp" class="btn">‚ñ≤</div>
        <div id="btnRight" class="btn">‚ñ∂</div>
    </div>

    <div id="game-over">
        <h1 id="death-msg">GAME OVER</h1>
        <button id="retry-btn" style="padding: 20px 40px; font-weight: bold; font-size: 20px; background: #2ecc71; border: none; color: white; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 0 #27ae60;">RECOME√áAR ADVENTURE</button>
    </div>

    <div id="viewport">
        <div id="world">
            <div id="ground"></div>
            <div id="player">
                <div class="mio" style="top:8px; left:20px"></div>
                <div class="mio" style="top:22px; left:8px"></div>
                <div class="mio" style="top:22px; right:8px"></div>
                <div class="mio" style="bottom:8px; left:20px"></div>
            </div>
        </div>
    </div>

<script>
    const world = document.getElementById('world');
    const player = document.getElementById('player');
    const livesDisplay = document.getElementById('lives-display');
    const scoreVal = document.getElementById('score-val');
    
    let posX = 150, posY = 60, velY = 0, velX = 0, score = 0, lives = 3;
    let isAlive = true, isInvincible = false, isJumping = false, onLava = false;
    let currentScene = 'surface', checkpoint = 'surface';
    let keys = { left: false, right: false };
    let worldWidth = 9000; 
    const gravity = 0.6, jumpForce = 15, speed = 8;
    let rotation = 0;
    let lavaDamageInterval = null;

    function updateHUD() {
        let heartIcon = (onLava && lives > 0) ? "‚ù§Ô∏è‚Äçüî•" : "‚ù§Ô∏è";
        livesDisplay.innerText = heartIcon.repeat(Math.max(0, lives));
        scoreVal.innerText = score;
    }

    function createParticle(color = '#f1c40f') {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.backgroundColor = color;
        p.style.left = (posX + 20) + 'px';
        p.style.bottom = (posY + 10) + 'px';
        world.appendChild(p);
        setTimeout(() => p.remove(), 600);
    }

    function clearWorld() {
        const items = world.querySelectorAll('.enemy, .platform, .tree, .mountain, .pipe, .spike, .nuvem, .coin, .particle, .heart-item');
        items.forEach(item => item.remove());
        if(lavaDamageInterval) { clearInterval(lavaDamageInterval); lavaDamageInterval = null; }
    }

    // --- CONSTRUTORES DE N√çVEL (Estrutura mantida conforme pedido) ---
    function buildSurface() {
        currentScene = 'surface'; checkpoint = 'surface'; worldWidth = 9000; onLava = false;
        world.style.width = worldWidth + "px"; clearWorld();
        document.body.className = 'surface-bg';
        document.getElementById('ground').style.display = 'block';
        document.getElementById('ground').className = '';
        document.getElementById('loc').innerText = "Superf√≠cie";
        posX = 150; posY = 60; velY = 0; updateHUD();

        for(let i=0; i<8; i++) {
            let m = document.createElement('div'); m.className = 'mountain';
            m.style.left = (i * 1500 + 300) + 'px'; world.appendChild(m);
        }
        createPipe(worldWidth - 200);
        for(let i=0; i<18; i++) {
            let t = document.createElement('div'); t.className = 'tree'; t.style.left = (500 + i * 500) + 'px'; world.appendChild(t);
            createPlat(800 + i*500, 180, 150);
            createCoin(850 + i*500, 230);
            if(i % 3 === 0 && i > 0) createEnemy(1200 + i*500, 60, '#c0392b');
        }
    }

    function buildCave() {
        currentScene = 'cave'; checkpoint = 'cave'; worldWidth = 8000; onLava = false;
        world.style.width = worldWidth + "px"; clearWorld();
        document.body.className = 'cave-bg';
        document.getElementById('ground').className = 'cave-ground';
        document.getElementById('loc').innerText = "Caverna Sombria";
        posX = 150; posY = 60; updateHUD();

        createPipe(worldWidth - 200);
        for(let i=0; i<20; i++) {
            let s = document.createElement('div'); s.className = 'spike'; s.style.left = (800 + i * 400) + 'px'; world.appendChild(s);
            createPlat(600 + i*400, 200 + (i%2)*80, 120);
            createCoin(630 + i*400, 350);
            if(i % 2 === 0) createEnemy(1000 + i*400, 60, '#4a148c');
        }
    }

    function buildSky() {
        currentScene = 'sky'; checkpoint = 'sky'; worldWidth = 8000; onLava = false;
        world.style.width = worldWidth + "px"; clearWorld();
        document.body.className = 'sky-bg';
        document.getElementById('ground').style.display = 'none';
        document.getElementById('loc').innerText = "C√©u (Flappy Pizza)";
        posX = 150; posY = 400; velY = 0; updateHUD();

        createPipe(worldWidth - 200);
        for(let i=0; i<25; i++) {
            createNuvem(800 + i * 450, 20 + Math.random() * 60);
            createCoin(1000 + i * 450, 300 + (Math.random()*200));
        }
    }

    function buildLava() {
        currentScene = 'lava'; checkpoint = 'lava'; worldWidth = 9000;
        world.style.width = worldWidth + "px"; clearWorld();
        document.body.className = 'lava-bg';
        document.getElementById('ground').style.display = 'block';
        document.getElementById('ground').className = 'lava-ground';
        document.getElementById('loc').innerText = "Inferno de Lava";
        posX = 150; posY = 200; velY = 0; updateHUD();

        createPipe(worldWidth - 200);
        for(let i=0; i<25; i++) {
            createPlat(400 + i*350, 180 + (i%3)*100, 130);
            createCoin(450 + i*350, 450);
            if(i % 5 === 0) createHeart(600 + i*350, 350);
            if(i % 3 === 0) createEnemy(500 + i*350, 60, '#f1c40f');
        }
    }

    // --- AUXILIARES ---
    function createPlat(x, y, w) {
        let p = document.createElement('div'); p.className = 'platform';
        p.style.left = x + 'px'; p.style.bottom = y + 'px'; p.style.width = w + 'px'; p.style.height = '20px';
        world.appendChild(p);
    }
    function createEnemy(x, y, color) {
        let e = document.createElement('div'); e.className = 'enemy';
        e.style.backgroundColor = color; e.style.left = x + 'px'; e.style.bottom = y + 'px';
        e.dataset.dir = 1; e.dataset.origin = x;
        world.appendChild(e);
    }
    function createNuvem(x, yPercent) {
        let n = document.createElement('div'); n.className = 'nuvem';
        n.style.width = '120px'; n.style.height = '45px'; n.style.background = '#fff'; n.style.borderRadius = '50px'; n.style.position = 'absolute';
        n.style.boxShadow = '20px 10px 0 #fff';
        n.style.left = x + 'px'; n.style.bottom = yPercent + '%';
        n.dataset.dir = 1; n.dataset.origin = x;
        world.appendChild(n);
    }
    function createCoin(x, y) {
        let c = document.createElement('div'); c.className = 'coin';
        c.style.left = x + 'px'; c.style.bottom = y + 'px'; world.appendChild(c);
    }
    function createHeart(x, y) {
        let h = document.createElement('div'); h.className = 'heart-item'; h.innerText = "‚ù§Ô∏è";
        h.style.position = 'absolute'; h.style.fontSize = '25px';
        h.style.left = x + 'px'; h.style.bottom = y + 'px'; world.appendChild(h);
    }
    function createPipe(x) {
        let p = document.createElement('div'); p.className = 'pipe'; p.style.left = x + 'px'; world.appendChild(p);
    }

    function handleJump() {
        if(!isAlive) return;
        if(currentScene === 'sky') { 
            velY = 8; // Ajustado para ser mais f√°cil de controlar
            rotation += 30; 
        } 
        else if(!isJumping) { 
            velY = jumpForce; 
            isJumping = true; 
        }
    }

    function takeDamage(instant = false) {
        if ((isInvincible && !instant) || !isAlive) return;
        lives--; updateHUD();
        if (lives <= 0) {
            die(onLava ? "PIZZA ASSADA DEMAIS!" : "PIZZA QUEIMADA!");
        } else { 
            isInvincible = true; player.style.opacity = "0.5";
            setTimeout(() => { isInvincible = false; player.style.opacity = "1"; }, 1000); 
        }
    }

    function gameLoop() {
        if (!isAlive) return;
        
        if(currentScene === 'sky') { 
            posX += 4; // Um pouco mais lento para dar tempo de reagir
            velY -= 0.4; // Gravidade mais leve no c√©u
        } else {
            if (keys.left) { posX -= speed; rotation -= 10; }
            if (keys.right) { posX += speed; rotation += 10; }
            velY -= gravity;
            if ((keys.left || keys.right) && !isJumping) if(Math.random() > 0.8) createParticle();
        }
        
        posY += velY;
        posX = Math.max(0, Math.min(posX, worldWidth - 55));

        if (currentScene !== 'sky') {
            if (posY <= 60) { 
                posY = 60; velY = 0; isJumping = false; 
                if(currentScene === 'lava') {
                    if(!onLava) { 
                        onLava = true; updateHUD(); 
                        if(lavaDamageInterval) clearInterval(lavaDamageInterval);
                        lavaDamageInterval = setInterval(() => { if(isAlive) takeDamage(true); }, 800); 
                    }
                }
            } else if(onLava) { 
                onLava = false; updateHUD(); clearInterval(lavaDamageInterval); lavaDamageInterval = null;
            }
        } else {
            // No c√©u, se sair muito da tela (cima/baixo), perde vida
            if (posY < -50 || posY > window.innerHeight) { lives = 0; die("DESINTEGROU NA ATMOSFERA!"); }
        }

        player.style.left = posX + 'px'; player.style.bottom = posY + 'px';
        player.style.transform = `rotate(${rotation}deg)`;

        let camX = -posX + window.innerWidth / 3;
        world.style.transform = `translateX(${Math.min(0, Math.max(camX, -(worldWidth - window.innerWidth)))}px)`;

        const pR = player.getBoundingClientRect();

        document.querySelectorAll('.platform').forEach(plat => {
            const platR = plat.getBoundingClientRect();
            if (velY <= 0 && isColliding(pR, platR)) {
                if (pR.bottom - velY >= platR.top) {
                    posY = parseFloat(plat.style.bottom) + 20; 
                    velY = 0; isJumping = false;
                }
            }
        });

        document.querySelectorAll('.coin').forEach(c => {
            if (isColliding(pR, c.getBoundingClientRect())) { c.remove(); score += 10; updateHUD(); }
        });

        document.querySelectorAll('.heart-item').forEach(h => {
            if (isColliding(pR, h.getBoundingClientRect())) { h.remove(); if(lives < 3) lives++; updateHUD(); }
        });

        document.querySelectorAll('.spike, .enemy, .nuvem').forEach(danger => {
            if (isColliding(pR, danger.getBoundingClientRect())) {
                const dR = danger.getBoundingClientRect();
                if (velY < 0 && pR.bottom < dR.top + 20 && !danger.classList.contains('nuvem') && !danger.classList.contains('spike')) {
                    danger.remove(); velY = 12; score += 50;
                } else { takeDamage(); }
            }
        });

        document.querySelectorAll('.enemy, .nuvem').forEach(el => {
            let x = parseFloat(el.style.left);
            let dir = parseFloat(el.dataset.dir);
            let origin = parseFloat(el.dataset.origin);
            x += dir * 2;
            if (Math.abs(x - origin) > 150) el.dataset.dir = -dir;
            el.style.left = x + 'px';
        });

        document.querySelectorAll('.pipe').forEach(pipe => {
            if (isColliding(pR, pipe.getBoundingClientRect())) {
                if(currentScene === 'surface') buildCave();
                else if(currentScene === 'cave') buildSky();
                else if(currentScene === 'sky') buildLava();
                else if(currentScene === 'lava') { isAlive = false; die("MESTRE PIZZAIOLO! üèÜ"); }
            }
        });

        if(isAlive) requestAnimationFrame(gameLoop);
    }

    function isColliding(a, b) { return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom); }
    
    function die(msg) { 
        isAlive = false; 
        if(lavaDamageInterval) clearInterval(lavaDamageInterval); 
        keys.left = keys.right = false;
        document.getElementById('death-msg').innerText = msg; 
        document.getElementById('game-over').style.display = 'flex'; 
    }

    document.getElementById('retry-btn').onclick = () => {
        lives = 3; score = 0; isAlive = true; isInvincible = false; onLava = false;
        document.getElementById('game-over').style.display = 'none';
        if (checkpoint === 'lava') buildLava(); 
        else if (checkpoint === 'sky') buildSky(); 
        else if (checkpoint === 'cave') buildCave(); 
        else buildSurface();
        requestAnimationFrame(gameLoop);
    };

    const setupBtn = (id, k) => {
        const b = document.getElementById(id);
        b.ontouchstart = (e) => { e.preventDefault(); if(k==='up') handleJump(); else keys[k]=true; };
        b.ontouchend = () => { if(k!=='up') keys[k]=false; };
        b.onmousedown = (e) => { if(k==='up') handleJump(); else keys[k]=true; };
        b.onmouseup = () => { if(k!=='up') keys[k]=false; };
    };
    setupBtn('btnLeft','left'); setupBtn('btnRight','right'); setupBtn('btnUp','up');
    
    window.onkeydown = (e) => { 
        if(e.key === "ArrowLeft") keys.left = true; 
        if(e.key === "ArrowRight") keys.right = true; 
        if(e.key === "ArrowUp" || e.key === " ") handleJump(); 
    };
    window.onkeyup = (e) => { if(e.key === "ArrowLeft") keys.left = false; if(e.key === "ArrowRight") keys.right = false; };

    buildSurface();
    requestAnimationFrame(gameLoop);
</script>
</body>
</html>
